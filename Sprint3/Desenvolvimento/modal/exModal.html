<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./exModal.css">
  <title>Dashboard</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  
</head>

<body>
  <button id="button-criar" onclick="abrirModal()"><img src="../assets/icons_cadastro/plus.png" alt="">CRIAR</button>

  <div class="fundo-modal" id="fundoModal">
    <div class="modal">
      <div class="cabecalho-modal">
        <h2 class="titulo-modal">Apartamento 801-A</h2>
        <button class="botao-fechar" id="botaoFechar">&times;</button>
      </div>
      
      <div class="conteudo-modal">
        <div class="localizacao">
            <span class="infoLoc">Localização:</span>
            <div class="apto">
                Torre A, Apartamento 801
            </div>
        </div>
        
        <div class="status-container">
            <span class="status">Status:</span>
            <div class="local">
                <span class="comodo">Cozinha</span>
            </div>
          <div class="status-label">
            <div class="indicador-status"></div>
            <span class="status-critico">Crítico</span>
          </div>
        </div>
        
        <div class="nivel-container">
          <div class="nivel-label">
            <span>Nível de Gás:</span>
            <span class="nivel-valor">13%</span>
          </div>
          <div class="barra-progresso-container">
            <div class="barra-progresso"></div>
          </div>
        </div>
        
        <div class="ultima-leitura">
          Última leitura: <span class="leitura-hora">Hoje, 15:38</span>
        </div>
        
        <div class="historico-label">
          <span>Histórico (2h)</span>
        </div>
        
        <div class="grafico-container">
          <canvas id="graficoGas"></canvas>
        </div>
        
        <div class="botoes-acoes">
          <button class="botao-azul">Verificar Sensor</button>
          <button class="botao-amarelo">Agendar Manutenção</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    function abrirModal() {
      document.getElementById('fundoModal').classList.add('ativo');
      setTimeout(inicializarGrafico, 50);
    }
    
    function inicializarGrafico() {
      const ctx = document.getElementById('graficoGas').getContext('2d');
      
      // Dados das últimas 2 horas com 12 leituras de 10 em 10 minutos
      const agora = new Date();
      const labels = [];
      const dados = [];
      
      for (let i = 11; i >= 0; i--) {
        const tempo = new Date(agora);
        tempo.setMinutes(tempo.getMinutes() - (i * 10));
        
        const hora = tempo.getHours().toString().padStart(2, '0');
        const minutos = tempo.getMinutes().toString().padStart(2, '0');
        labels.push(`${hora}:${minutos}`);
        
        // Gerar valores aleatórios entre 15% e 20%
        dados.push(Math.floor(Math.random() * (20 - 15 + 1)) + 15);
      }
      
      // Destruir gráfico anterior se existir
      if (window.chartInstance) {
        window.chartInstance.destroy();
      }
      
      // Criar novo gráfico
      window.chartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            data: dados,
            borderColor: '#e53935',
            backgroundColor: 'rgba(229, 57, 53, 0.1)',
            borderWidth: 2,
            pointRadius: 2,
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              enabled: true
            }
          },
          scales: {
            x: {
              grid: {
                display: false
              },
              ticks: {
                font: {
                  size: 8
                },
                maxRotation: 0
              }
            },
            y: {
              min: 0,
              max: 20,
              ticks: {
                stepSize: 5,
                font: {
                  size: 8
                }
              }
            }
          },
          elements: {
            point: {
              radius: 1
            }
          }
        }
      });
    }
    
    document.addEventListener('DOMContentLoaded', function() {
      const fundoModal = document.getElementById('fundoModal');
      const botaoFechar = document.getElementById('botaoFechar');
      
      function fecharModal() {
        fundoModal.classList.remove('ativo');
      }
      
      botaoFechar.addEventListener('click', fecharModal);
      
      fundoModal.addEventListener('click', function(e) {
        if (e.target === fundoModal) {
          fecharModal();
        }
      });
    });
  </script>
</body>

</html>